name: Game scope check

on:
  pull_request:

jobs:
  game-scope:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Check if scope check should be skipped
        id: check-skip
        run: |
          # Skip for release PRs (develop → main)
          if [[ "${{ github.base_ref }}" == "main" ]]; then
            echo "should_skip=true" >> $GITHUB_OUTPUT
            echo "reason=Release PR (develop → main)" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # Skip for infrastructure/UI development branches
          BRANCH_NAME="${{ github.head_ref }}"
          if [[ "$BRANCH_NAME" =~ ^(feature/ui-|feature/infra-|feature/core-|chore/|docs/|ci/) ]]; then
            echo "should_skip=true" >> $GITHUB_OUTPUT
            echo "reason=Infrastructure/UI branch ($BRANCH_NAME)" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # Skip if PR has 'infrastructure' or 'skip-game-scope' label
          # (This would require additional GitHub API call, keeping it simple for now)
          
          echo "should_skip=false" >> $GITHUB_OUTPUT

      - name: Verify game scope
        if: steps.check-skip.outputs.should_skip != 'true'
        run: node scripts/check-game-scope.js

      - name: Skip check
        if: steps.check-skip.outputs.should_skip == 'true'
        run: echo "Skipping game scope check - ${{ steps.check-skip.outputs.reason }}"
